%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 11 pt, conference]{ieeeconf}

% This command is only needed if 
% you want to use the \thanks command
\IEEEoverridecommandlockouts

% Needed to meet printer requirements.
\overrideIEEEmargins                                     

%In case you encounter the following error:
%Error 1010 The PDF file may be corrupt (unable to open PDF file) OR
%Error 1000 An error occurred while parsing a contents stream. Unable to analyze the PDF file.
%This is a known problem with pdfLaTeX conversion filter. The file cannot be opened with acrobat reader
%Please use one of the alternatives below to circumvent this error by uncommenting one or the other
%\pdfobjcompresslevel=0
%\pdfminorversion=4

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
%\usepackage{graphics} % for pdf, bitmapped graphics files
%\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
\usepackage{amsmath} % assumes amsmath package installed
\usepackage{amssymb}  % assumes amsmath package installed

\title{\LARGE \bf Sensitivity Analysis for Neural Network Controllers}


\author{Kyle Morgenstein$^{1,2}$\\kjm3887% <-this % stops a space
% \thanks{*This work was not supported by any organization}% <-this % stops a space
\thanks{$^{1}$Aerospace Engineering,
        UT Austin
        {\tt\small kylem@utexas.edu}}%
\thanks{$^{2}$Apptronik, Inc.
        {\tt\small kylemorgenstein@apptronik.com}}%
}


\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}


\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}

Reinforcement learning (RL) has become the standard control technique in legged locomotion due to its robustness, expressivity, and ease of deployment.
Despite these attributes, RL control policies still fail catastrophically when evaluated on out of distribution (OOD) inputs.
Due to the black box nature of RL policies, safety efforts largely focus on observing potentially destabilizing changes in the action space of the policy, and triggering safe modes when risk thresholds are reached (e.g. over-current protection).
Efforts to quantify the distribution of valid inputs during training may result in more proactive runtime anomaly detection, but such efforts provide only weak guarantees of stability given the distribution shift between simulation-based training and hardware deployment.
In this work we propose a more rigorous treatment of anomaly detection using tools from nonlinear sensitivity analysis.
Treating the trained policy as an artifact, we aim to exploit the structure of the learning-based controller to provide stronger guarantees to prevent catastrophic failure at runtime.

\section{SYSTEM MODELING}

Consider a nonlinear, time varying system
\begin{equation}
\dot x_t = f(x_t) + g(x_t)u_t
\end{equation}
with state $x_t\in\mathbb{R}^m$ and control signal $u_t\in\mathbb{R}^n$.
We seek to understand the sensitivity of the closed loop dynamics without assuming knowledge of $f$ or $g$.
Let $u_t = \pi(z_t)$ be the output from a neural network controller tracking a reference signal such that the error dynamics
\begin{equation}
\begin{split}
z_t &:=x_t-x^\text{ref}_t \\
\dot z_t &= F(z_t, \pi(z_t))
\end{split}
\end{equation}
has an equilibrium at $F(0,\pi(0))=0\forall t$.
The linearized closed loop system Jacobian
\begin{equation}
J_\text{cl} = \frac{\partial F}{\partial z_t}\bigg\vert_{z_t=0} 
\end{equation}
and can be estimated as follows:

For $k=1,...,N$ select perturbation direction $d^{(k)}\in\mathbb{R}^n$ with $||d^{(k)}||=1$ and radius $h\in\mathbb{R}$.
Then define the finite difference
\begin{equation}
y^{(k)} := \frac{F(hd^{(k)})-F(-hd^{(k)})}{2h}
\end{equation}
with estimator $y^{(k)}=J_\text{cl}d^{(k)}+\epsilon^{(k)}$, $\epsilon^{(k)}\sim\mathcal{N}(0,\Sigma)$.
Let $Y=[y^{(1)},...,y^{(N)}]\in\mathbb{R}^{n\times N}$, $D=[d^{(1)},...,d^{(N)}]\in\mathbb{R}^{n\times N}$ and $E=[\epsilon^{(1)},...,\epsilon^{(N)}]\in\mathbb{R}^{n\times N}$.
Then, 
\begin{equation}
\begin{split}
Y&=J_\text{cl} D+E \\
\hat J_\text{cl} &= YD^T(DD^T)^{-1}
\end{split}
\end{equation}
if $DD^T$ is invertible (i.e. $\{d^{(k)}\}$ spans $\mathbb{R}^n$).
A valid choice of $\{d^{(k)}\}$ requires $N\geq n$.



Divergence happens near singularity of open loop dynamics and sensitive regions of policy

Show with $M\ddot q = \tau$

Assume not near singularity

Then sensitive only if policy is sensitive

Do policy analysis





\section{SYSTEM ANALYSIS AND DESIGN}

\section{SIMULATION RESULTS}

\section{CONCLUSIONS}

This template provides authors with most of the formatting specifications needed for preparing electronic versions of their papers. All standard paper components have been specified for three reasons: (1) ease of use when formatting individual papers, (2) automatic compliance to electronic requirements that facilitate the concurrent or later production of electronic products, and (3) conformity of style throughout a conference proceedings. Margins, column widths, line spacing, and type styles are built-in; examples of the type styles are provided throughout this document and are identified in italic type, within parentheses, following the example. Some components, such as multi-leveled equations, graphics, and tables are not prescribed, although the various table text styles are provided. The formatter will need to create these components, incorporating the applicable criteria that follow.



\section{MATH}




\subsection{Equations}

The equations are an exception to the prescribed specifications of this template. You will need to determine whether or not your equation should be typed using either the Times New Roman or the Symbol font (please no other font). To create multileveled equations, it may be necessary to treat the equation as a graphic and insert it into the text after your paper is styled. Number equations consecutively. Equation numbers, within parentheses, are to position flush right, as in (1), using a right tab stop. To make your equations more compact, you may use the solidus ( / ), the exp function, or appropriate exponents. Italicize Roman symbols for quantities and variables, but not Greek symbols. Use a long dash rather than a hyphen for a minus sign. Punctuate equations with commas or periods when they are part of a sentence, as in

$$
\alpha + \beta = \chi \eqno{(1)}
$$

Note that the equation is centered using a center tab stop. Be sure that the symbols in your equation have been defined before or immediately following the equation. Use ``(1)'', not ``Eq. (1)'' or ``equation (1)'', except at the beginning of a sentence: ``Equation (1) is . . .''


\subsection{Figures and Tables}

Positioning Figures and Tables: Place figures and tables at the top and bottom of columns. Avoid placing them in the middle of columns. Large figures and tables may span across both columns. Figure captions should be below the figures; table heads should appear above the tables. Insert figures and tables after they are cited in the text. Use the abbreviation ``Fig. 1'', even at the beginning of a sentence. \cite{hermann77}

\begin{table}[h]
\caption{An Example of a Table}
\label{table_example}
\begin{center}
\begin{tabular}{|c||c|}
\hline
One & Two\\
\hline
Three & Four\\
\hline
\end{tabular}
\end{center}
\end{table}


\begin{figure}[thpb]
\centering
\framebox{\parbox{3in}{We suggest that you use a text box to insert a graphic (which is ideally a 300 dpi TIFF or EPS file, with all fonts embedded) because, in an document, this method is somewhat more stable than directly inserting a picture.
}}
%\includegraphics[scale=1.0]{figurefile}
\caption{Inductance of oscillation winding on amorphous
magnetic core versus DC bias magnetic field}
\label{figurelabel}
\end{figure}


% This command serves to balance the column lengths
% on the last page of the document manually. It shortens
% the text height of the last page by a suitable amount.
% This command does not take effect until the next page
% so it should come on the page before the last. Make
% sure that you do not shorten the text height too much.
\addtolength{\textheight}{-12cm}  


\section*{APPENDIX}

Appendixes should appear before the acknowledgment.

\section*{ACKNOWLEDGMENT}




\nocite{*}
\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,references}


\end{document}
